# Building Skeleton

Skeleton was built using the Metaproject Generator. The installation 
instructions for the generator and its dependencies are listed on
https://github.com/bravado/generator-metaproject

To get started, run
 `yo metaproject` on your project's directory, in this case, `skeleton`

    mkdir skeleton
    cd skeleton
    yo metaproject
                 __                       _         __ 
      __ _  ___ / /____ ____  _______    (_)__ ____/ /_
     /  ' \/ -_) __/ _ `/ _ \/ __/ _ \  / / -_) __/ __/
    /_/_/_/\__/\__/\_,_/ .__/_/  \___/_/ /\__/\__/\__/ 
                      /_/           |___/              
    
    [?] Package Name: skeleton
    [?] Application Title: Skeleton
    [?] Version: 0.0.1
    [?] Comma separated list of authors: Your Name <your@email.tld>
    [?] Comma separated list of keywords: metaproject, app
    [?] License: MIT
    [?] Homepage: https://github.com/objectiveweb/skeleton

Yeoman will generate the main application structure then run 
`bower install` to install all the UI dependencies.

If you're running apache, visit http://server/skeleton to check your 
initial app.

If you don't have a local webserver to export the application, run

    python -m SimpleHTTPServer 8080

to export the current directory on port 8080, then visit 
http://localhost:8080/app/index.html on your browser of choice.

## Application Structure

    skeleton/
        `- app/
            `- core/
            `- modules/
              `- base/
              `- AdminLTE/
              `- products/
              `- index.js
              `- models.js
            `- main.js
            `- script.js
            `- style.css
            `- index.html

 * The `app/` directory stores the public application files.
    * `app/core` holds the core framework
    * `main.js` bootstraps the application
    * `script.js` Additional scripts
    * `style.css` Additional styles
    * `index.html` Main app structure
 
* Every module is self contained and stored under `app/modules`
    * `app/modules/index.js` holds the modules url mapping
    * `app/modules/models.js` defines the shared Data Models used by 
    the application.

Modules are framework-agnostic. The architecture, provided by 
BoilerplateJS, demonstrates the best practices for integrating your 
libraries for large scale product development. 

You can add additional modules to your application using the `module`
subgenerator

    yo metaproject:module name

Creates a default module with separate `viewmodel.js` and submodule 
support.

    yo metaproject:module name --simple

Creates a simple module with inline `viewModel` and a single endpoint.

## The base module

This is a `simple` module is generated by Yeoman. It is defined in 
`app/modules/base/module.js`

    /*global define: true, metaproject: true, ko: true, $: true */
    define(function (require) {
        "use strict";
    
        // Module dependencies
        var Boiler = require('Boiler'),
            menuTemplate = require('text!./menu.html'),
            viewTemplate = require('text!./view.html');
    
        var viewModel = {
            name: 'Skeleton',
            url: 'https://github.com/objectiveweb/skeleton'
        };
    
        // initialization code
        $('.sidebar-menu').prepend(menuTemplate);
    
        // module definition
        return {
            template: viewTemplate,
            viewModel: viewModel
        };
    
    });

 * `menu.html` defines the sidebar-menu which will be attached to the 
  interface
 * `view.html` holds the main module template. It gets injected on 
 `app-content` and shows/hides depending on the url
 * `viewModel` is the main View Controller, holds the variables and 
 functions used by the view
 
This module is loaded by the application in `app/modules/index.js`

    define(function(require) {
    
        // return the list of available modules
        return {
            "/": require("./base/module")
        };
    });

It will be displayed when you access the application root.

## The AdminLTE Sampler

The AdminLTE module bundles the AdminLTE docs into our app. It is 
defined in the `app/modules/AdminLTE/module.js` file which showcases a 
simple module which displays different HTML files depending on the app 
URL. It has no external dependencies.

    /*global define: true, metaproject: true, ko: true, $: true */
    define(function (require) {
        "use strict";
    
        // append the sidebar menu
        $('.sidebar-menu').append(require('text!./menu.html'));
    
        // return multiple URLs
        return function (context) {
    
            return {
                "/": {
                    template: require('text!./widgets.html')
                },
                "/general": {
                    template: require('text!./general.html')
                },
                "/icons": {
                    template: require('text!./icons.html')
                },
                "/buttons": {
                    template: require('text!./buttons.html')
                },
                "/forms": {
                    template: require('text!./forms.html')
                },
                "/tables": {
                    template: require('text!./tables.html')
                }
            }
        };
    
    });

After creating the `module.js` file, add the newly created module to 
`app/modules/index.js`

    return {
        "/": require("./base/module"),
        "/AdminLTE": require("./AdminLTE/module")
    };

Visiting `http://localhost:8080/#/AdminLTE/buttons` will display 
the buttons.html file

## The Products listing

This modules showcases Metaproject's Crud Generator. We'll define a 
Product model and bind it to a REST endpoint. The generator will
build the boilerplate code for listing and editing each resource.

To test this module, you'll need a configured apache webserver with a 
local Objectiveweb installation.

### Backend Setup

We'll use `objectiveweb` as the backend. For a quick overview on the
setup, please visit https://github.com/bravado/objectiveweb

First, create the `product` database table
    
    CREATE TABLE product
    (
        id INT UNSIGNED PRIMARY KEY NOT NULL AUTO_INCREMENT,
        description VARCHAR(255) NOT NULL
    );

Then, register the `product` domain on Skeleton's `_init.php`

    <?php
    register_domain('product', array(
        'handler' => 'TableStore',
        'public' => true,
        'table' => 'product'));

Skeleton must be enabled on `ow-config.php` so that `_init.php` is
included properly.

    register_app('skeleton');
    
For each application, Objectiveweb will expose the registered domains 
using a REST Api. In this example

  * `GET /objectiveweb/product/`  Lists all products
  * `GET /objectiveweb/product/id` Retrieves product `id`
  * `POST /objectiveweb/product/` Creates a new product, returns its 
  `id`
  * `PUT /objectiveweb/product/id`  Updates product `id`
  * `DELETE /objectiveweb/product/id` Deletes product `id`

### UI

Edit `app/modules/models.js` and add the following Model definition

    models.Product = metaproject.Model({
        id: null,
        description: null
    }).bind('../objectiveweb/product');

Then, on your terminal run 
`yo metaproject:crud products Product --menu` to build the `products` 
module using the `Product` model and add it to the sidebar menu

      __ _  ___ / /____ ____  _______    (_)__ ____/ /_
     /  ' \/ -_) __/ _ `/ _ \/ __/ _ \  / / -_) __/ __/
    /_/_/_/\__/\__/\_,_/ .__/_/  \___/_/ /\__/\__/\__/ 
                      /_/           |___/              
    
       create app/modules/products/module.js
       create app/modules/products/viewmodel.js
       create app/modules/products/detail.js
       create app/modules/products/menu.html
       create app/modules/products/detail.html
       create app/modules/products/view.html


Now, enable the `products` module on `app/modules/index.js`

    return { 
        ...,
        '/products': require('./products/module')
    }        

Visit http://server/skeleton/#/products to test the new module.